{% load static %}
{% load users %}

<nav
  class="sticky top-0 left-0 z-20 w-full p-6 bg-blue-1"
  x-data="{ open: false, articleOpen: false, submenuOpen: false, expertOpen: false, userMenuOpen: false, teacherOpen: false}"
  @resize.window="if (window.innerWidth > 768) open = false"
>
<div class="flex items-center justify-between">
  <div class="flex items-center text-3xl font-bold text-vanilla-7 animate-pulse">
      <a href="{% url 'index' %}" class="flex items-center">
        TECHECHO
        <img src="{% static 'image/logo1.jpg' %}" alt="logo" class="w-16 ml-1 h-14">
      </a>
  </div>
  {% if request.path != '/' %}
  <form
    method="GET"
    action="{% url 'search' %}"
    class="relative flex items-center"
  >
    <input
      type="text"
      name="q"
      class="w-full h-12 p-4 bg-white border border-gray-300 rounded-3xl"
      placeholder="Search..."
      value="{{ query }}"
    />
    <button type="submit" class="absolute text-gray-500 bottom-3 right-3">
      <i class="fa-solid fa-magnifying-glass"></i>
    </button>
  </form>
  {% endif %}
  <ul class="hidden space-x-4 text-xl text-white md:flex whitespace-nowrap">
    <li class="relative tooltip tooltip-bottom" data-tip="發表嗎？">
      <a
        href="#"
        @click="articleOpen = !articleOpen"
        class="transition duration-300 ease-in-out hover:text-green-3"
      >
        文章
      </a>
      <ul
        x-show="articleOpen"
        @click.away="articleOpen = false"
        class="absolute left-0 z-20 mt-9 w-60 text-green-3 bg-vanilla-7"
        style="display: none"
      >
        <li>
          <a
            href="{% url 'blogs:index' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4 hover:text-white"
          >
            分享
          </a>
        </li>
      </ul>
    </li>
    <li class="relative tooltip tooltip-bottom" data-tip="問看看？">

      <a
        href="#"
        @click="submenuOpen = !submenuOpen"
        class="transition duration-300 ease-in-out hover:text-green-3"
        >討論
      </a>
      <ul
        x-show="submenuOpen"
        @click.away="submenuOpen = false"
        class="absolute left-0 z-20 mt-9 text-green-3 w-60 bg-vanilla-7"
        style="display: none"
      >
        <li>
          <a
            href="{% url 'questions:new' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4 hover:text-white"
            >發問題
          </a>
        </li>
        <li>
          <a
            href="{% url 'questions:index' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4 hover:text-white"
            >看問題
          </a>
        </li>
      </ul>
    </li>
    <li class="relative tooltip tooltip-bottom" data-tip="找專家？">
      <a
        href="#"
        @click="expertOpen = !expertOpen"
        class="transition duration-300 ease-in-out hover:text-green-3"
        >專家
      </a>
      <ul
        x-show="expertOpen"
        @click.away="expertOpen = false"
        class="absolute left-0 z-20 mt-9 text-green-3 w-60 bg-vanilla-7"
        style="display: none"
      >
        <li>
          <a
            href="{% url 'teachers:index' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
            >專家清單
          </a>
        </li>
        <li>
          <a
            href="{% url 'teachers:mentor' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4 hover:text-white"
            >當專家
          </a>
        </li>
        <li>
          <a
            href="{% url 'payments:index' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4 hover:text-white"
            >問專家
          </a>
        </li>
      </ul>
    </li>
    <li class="relative tooltip tooltip-bottom" data-tip="想預約？">
      <a
        href="#"
        @click="teacherOpen = !teacherOpen"
        class="transition duration-300 ease-in-out hover:text-green-3"
        >預約
      </a>
      <ul
        x-show="teacherOpen"
        @click.away="teacherOpen = false"
        class="absolute left-0 z-20 mt-9 text-green-3 w-60 bg-vanilla-7"
        style="display: none"
      >
        <li>
          <a
            href="{% url 'reservations:teacher_available' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4 hover:text-white"
            >專家時間
          </a>
        </li>
      </ul>
    </li>

    {% if user.is_authenticated %}
    <div
      class="relative inline-flex items-center"
      @click="userMenuOpen = !userMenuOpen"
    >
      <span
        class="pr-3 no-underline transition duration-300 ease-in-out hover:text-green-3 hover:underline"
        >{{ user.username }}
      </span>
      {% if user.profile_picture %}
      <img
        src="{{ user.profile_picture.url }}"
        alt="Profile Picture"
        class="rounded-full cursor-pointer w-7 h-7"
      />
      {% else %}
      <img
        src="https://fakeimg.pl/240x240/282828/eae0d0/?text=User+Avatar"
        alt="User Avatar"
        class="rounded-full cursor-pointer w-7 h-7"
      />
      {% endif %}
      <ul
        x-show="userMenuOpen"
        @click.away="userMenuOpen = false"
        class="absolute left-0 z-20 top-5 mt-9 text-green-3 w-60 bg-vanilla-7"
        style="display: none"
      >
        <li>
          <a
            href="{% url 'users:profile' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4 hover:text-white"
            >個人簡介
          </a>
        </li>
        <li>
          <a
            href="{% url 'users:logout' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4 hover:text-white"
            >登出
          </a>
        </li>
      </ul>
    </div>
    {% include "layouts/notifications.html" with user=user %} {% else %}
    <li>
      <a
        href="{% url 'users:login'%}?next={{ request.path }}"
        class="transition duration-300 ease-in-out hover:text-green-3"
        >登入
      </a>
    </li>
    <li class="relative tooltip tooltip-bottom" data-tip="沒有帳號？">
      <a
        href="{% url 'users:register' %}"
        class="transition duration-300 ease-in-out hover:text-green-3"
        >註冊
      </a>
    </li>
    {% endif %}
  </ul>
  <button
    @click="open = !open"
    class="relative text-xl text-white md:hidden whitespace-nowrap"
  >
    選單
  </button>
</div>
</div>



<ul
  class="absolute right-0 z-10 w-full mt-6 text-lg shadow-md bg-vanilla-7"
  x-show="open"
  @click.away="open = false"
  style="display: none"
>

  <li @click="articleOpen = !articleOpen">
    <a
      href="#"
      class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
    >文章
    </a>
    <ul x-show="articleOpen" class="mt-2 ml-4">
      <li>
        <a
          href="{% url 'blogs:index' %}"
          class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
        >
          分享
        </a>
      </li>
      <li @click="submenuOpen = !submenuOpen">
        <a
          href="#"
          class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
        >討論
        </a>
        <ul x-show="submenuOpen" class="mt-2 ml-4">
          <li>
            <a
              href="{% url 'questions:new' %}"
              class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
            >
              發問題
            </a>
          </li>
          <li>
            <a
              href="{% url 'questions:index' %}"
              class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
            >
              看問題
            </a>
          </li>
        </ul>
      </li>
    </ul> <!-- 這個結束標籤 -->
  </li>

  <li @click="expertOpen = !expertOpen">
    <a
      href="#"
      class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
    >專家
    </a>
    <ul x-show="expertOpen" class="mt-2 ml-4">
      <li>
        <a
          href="{% url 'teachers:index' %}"
          class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
        >專家清單
        </a>
      </li>
      <li>
        <a
          href="{% url 'teachers:new' %}"
          class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
        >當專家
        </a>
      </li>
      <li>
        <a
          href="{% url 'teachers:index' %}"
          class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
        >問專家
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a
      href="#"
      class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
    >預約
    </a>
  </li>

  {% if user.is_authenticated %}
  <li>
    <a
      href="{% url 'users:logout'%}"
      class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
    >登出
    </a>
  </li>
  {% else %}
  <li>
    <a
      href="{% url 'users:login'%}?next={{ request.path }}"
      class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
    >登入
    </a>
  </li>
  <li class="relative tooltip tooltip-bottom" data-tip="沒有帳號？">
    <a
      href="{% url 'users:register' %}"
      class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4 hover:text-white"
    >註冊
    </a>
  </li>
  {% endif %}
</ul>
</nav>