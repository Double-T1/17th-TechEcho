{% extends 'layouts/base.html' %}

{% comment %} chat-start chat-end {% endcomment %}
{% load chat %}
{% block content %}

<div class="p-6 max-w-4xl mx-auto">
    <div class="border-2 mx-auto shadow-lg rounded-lg">
        <div id="banner" class="relative flex justify-center items-center text-xl bg-vanilla-5 py-2 text-center">
            {% if online_count|add:'-1' %}
                <span class="dot green-dot absolute top-1 left-1"></span>
                <img src="https://via.placeholder.com/40" alt="photo" class="w-12 h-12 rounded-full mr-4">
                <p>{{ other_user }} 在線</p>
            {% else %}
                <span class="dot gray-dot absolute top-1 left-1"></span>
                <p>無人上線</p>
            {% endif %}
        </div>


        <div class="w-11/12 mb-6 mx-auto">
            <ul id="message_list" class="mb-2">
                {% for message in chat_messages %}
                <li class="chat
                        chat-{% if message|check_author:user %}end{% else %}start{% endif %}">
                    <div class="chat-header">
                        {{ message.author.username }}
                        <time class="text-xs opacity-50">{{message.created_at}}</time>
                    </div>
                    <div class="chat-bubble
                        {% if message|check_author:user %}
                            chat-bubble-success
                        {% else %}
                            bg-blue-1 text-white
                        {% endif %}">
                        {{ message.content }}
                    </div>
                    <div class="chat-footer opacity-50">Delivered</div>
                </li>
                {% endfor %}
            </ul>

            <form class="py-2 flex flex-row gap-2"
                hx-ext="ws"
                ws-connect="/ws/chatroom/{{ chat_group.id }}/"
                ws-send
                hx-on="htmx:wsAfterSend: this.reset()">
                {% csrf_token %}

                {% for field in form %}
                <div class="form-control w-full">
                    {{ field }}
                    {% if field.errors %}
                    <span class="text-red-500">{{ field.errors }}</span>
                    {% endif %}
                </div>
                {% endfor%}
                <button class="btn btn-md bg-green-3 text-white">發送</button>
            </form>
        </div>
    </div>
</div>

{% endblock %}
